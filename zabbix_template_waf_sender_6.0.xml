<?xml version='1.0' encoding='UTF-8'?>
<zabbix_export>
    <version>6.0</version>
    <date>2024-01-22T15:07:42Z</date>
    <templates>
        <template>
            <uuid>e4f876c386a648afae610490267e44b4</uuid>
            <template>Template WAF Traffic Monitor Sender</template>
            <name>Template WAF Traffic Monitor Sender</name>
            <description>明御WAF流量监控模板 - Zabbix Sender模式，支持批量数据采集</description>
            <groups>
                <group>
                    <name>Templates/Applications</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>6389495c1b7d43fe920b215a64183e83</uuid>
                    <name>WAF数据采集器状态</name>
                    <type>TRAP</type>
                    <key>waf.collector.status</key>
                    <delay>0</delay>
                    <history>7d</history>
                    <trends>30d</trends>
                    <value_type>UNSIGNED</value_type>
                    <description>WAF数据采集器运行状态：1=正常，0=异常</description>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>collector</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>44e08fc995c04b359726f90e9e863c6b</uuid>
                    <name>WAF数据采集时间</name>
                    <type>TRAP</type>
                    <key>waf.collector.timestamp</key>
                    <delay>0</delay>
                    <history>7d</history>
                    <trends>0</trends>
                    <value_type>UNSIGNED</value_type>
                    <units>unixtime</units>
                    <description>最后一次成功采集数据的时间戳</description>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>collector</value>
                        </tag>
                    </tags>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <uuid>9c0f21c9d8ee4f37887b3b062f20c970</uuid>
                    <name>WAF站点发现</name>
                    <type>TRAP</type>
                    <key>waf.sites.discovery</key>
                    <delay>0</delay>
                    <lifetime>7d</lifetime>
                    <description>自动发现WAF中的所有站点</description>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>2ba0b09b215543ae945a6a5336fc0e70</uuid>
                            <name>站点 {#SITE_NAME} - 状态</name>
                            <type>TRAP</type>
                            <key>waf.site.status[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>UNSIGNED</value_type>
                            <description>站点启用状态：1=启用，0=禁用</description>
                            <valuemap>
                                <name>站点状态</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>10m</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>site</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>185de1e706cb4daa9eecc796d1858b86</uuid>
                            <name>站点 {#SITE_NAME} - 入站流量速率(平均)</name>
                            <type>TRAP</type>
                            <key>waf.site.bytes_in_rate_avg[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <units>bps</units>
                            <description>入站流量速率平均值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>traffic</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                                <tag>
                                    <tag>direction</tag>
                                    <value>inbound</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>6815f9cb7b2b4a1a9171c6362ca3a840</uuid>
                            <name>站点 {#SITE_NAME} - 入站流量速率(最大)</name>
                            <type>TRAP</type>
                            <key>waf.site.bytes_in_rate_max[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <units>bps</units>
                            <description>入站流量速率最大值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>traffic</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                                <tag>
                                    <tag>direction</tag>
                                    <value>inbound</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>fde3f49be36d4acda043a8b870927a46</uuid>
                            <name>站点 {#SITE_NAME} - 出站流量速率(平均)</name>
                            <type>TRAP</type>
                            <key>waf.site.bytes_out_rate_avg[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <units>bps</units>
                            <description>出站流量速率平均值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>traffic</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                                <tag>
                                    <tag>direction</tag>
                                    <value>outbound</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>77b73182c4e64e78a5ebf7bdbcdf3b8e</uuid>
                            <name>站点 {#SITE_NAME} - 出站流量速率(最大)</name>
                            <type>TRAP</type>
                            <key>waf.site.bytes_out_rate_max[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <units>bps</units>
                            <description>出站流量速率最大值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>traffic</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                                <tag>
                                    <tag>direction</tag>
                                    <value>outbound</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>81a82fcc8ee44e3281110a4c4235a881</uuid>
                            <name>站点 {#SITE_NAME} - 当前连接数(平均)</name>
                            <type>TRAP</type>
                            <key>waf.site.conn_cur_avg[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <description>当前连接数平均值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>connection</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>0f6e84cf998f4b8db9b6aa15273e4ecf</uuid>
                            <name>站点 {#SITE_NAME} - 当前连接数(最大)</name>
                            <type>TRAP</type>
                            <key>waf.site.conn_cur_max[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <description>当前连接数最大值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>connection</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>26d3e49df6144dcda073d9b7006ebabe</uuid>
                            <name>站点 {#SITE_NAME} - 连接速率(平均)</name>
                            <type>TRAP</type>
                            <key>waf.site.conn_rate_avg[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <units>cps</units>
                            <description>连接速率平均值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>connection</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>3a788badd2be4c21a10d8e660344c6bc</uuid>
                            <name>站点 {#SITE_NAME} - HTTP请求数(平均)</name>
                            <type>TRAP</type>
                            <key>waf.site.http_req_cnt_avg[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <description>HTTP请求数平均值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>http</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>d25e2f553588438a9429fb8a5bc968a2</uuid>
                            <name>站点 {#SITE_NAME} - HTTP请求数(最大)</name>
                            <type>TRAP</type>
                            <key>waf.site.http_req_cnt_max[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <description>HTTP请求数最大值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>http</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>f98c56c00bec45e5a65b82ca9f55531e</uuid>
                            <name>站点 {#SITE_NAME} - HTTP请求速率(平均)</name>
                            <type>TRAP</type>
                            <key>waf.site.http_req_rate_avg[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <units>rps</units>
                            <description>HTTP请求速率平均值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>http</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <uuid>7c0c1fecacb949ebaf9fecdf2dd4189e</uuid>
                            <expression>last(/Template WAF Traffic Monitor Sender/waf.site.status[{#SITE_NAME}])=0</expression>
                            <name>站点 {#SITE_NAME} 已禁用</name>
                            <priority>WARNING</priority>
                            <description>站点已被禁用</description>
                            <manual_close>YES</manual_close>
                            <tags>
                                <tag>
                                    <tag>scope</tag>
                                    <value>availability</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>9b861c1732584ecd823f74884b78ec66</uuid>
                            <expression>avg(/Template WAF Traffic Monitor Sender/waf.site.bytes_in_rate_avg[{#SITE_NAME}],5m)&gt;{$WAF.TRAFFIC.MAX.WARN}</expression>
                            <name>站点 {#SITE_NAME} 入站流量过高</name>
                            <event_name>站点 {#SITE_NAME}: 入站流量过高 (超过 {$WAF.TRAFFIC.MAX.WARN} 5分钟)</event_name>
                            <priority>WARNING</priority>
                            <description>入站流量超过阈值</description>
                            <manual_close>YES</manual_close>
                            <tags>
                                <tag>
                                    <tag>scope</tag>
                                    <value>performance</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>48de1f020f5346608cf96bfd3e413108</uuid>
                            <expression>avg(/Template WAF Traffic Monitor Sender/waf.site.conn_cur_avg[{#SITE_NAME}],5m)&gt;{$WAF.CONN.MAX.WARN}</expression>
                            <name>站点 {#SITE_NAME} 连接数过高</name>
                            <event_name>站点 {#SITE_NAME}: 连接数过高 (超过 {$WAF.CONN.MAX.WARN} 5分钟)</event_name>
                            <priority>WARNING</priority>
                            <description>当前连接数超过阈值</description>
                            <manual_close>YES</manual_close>
                            <tags>
                                <tag>
                                    <tag>scope</tag>
                                    <value>performance</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>dca5ead41b164ff291dc9c691cfad40c</uuid>
                            <expression>avg(/Template WAF Traffic Monitor Sender/waf.site.http_req_rate_avg[{#SITE_NAME}],5m)&gt;{$WAF.REQ_RATE.MAX.WARN}</expression>
                            <name>站点 {#SITE_NAME} HTTP请求速率过高</name>
                            <event_name>站点 {#SITE_NAME}: HTTP请求速率过高 (超过 {$WAF.REQ_RATE.MAX.WARN} 5分钟)</event_name>
                            <priority>WARNING</priority>
                            <description>HTTP请求速率超过阈值</description>
                            <manual_close>YES</manual_close>
                            <tags>
                                <tag>
                                    <tag>scope</tag>
                                    <value>performance</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>ffbac40b51d442b7ab697d37018f7b8a</uuid>
                            <expression>nodata(/Template WAF Traffic Monitor Sender/waf.site.bytes_in_rate_avg[{#SITE_NAME}],30m)=1</expression>
                            <name>站点 {#SITE_NAME} 无法获取流量数据</name>
                            <event_name>站点 {#SITE_NAME}: 30分钟内无法获取流量数据</event_name>
                            <priority>WARNING</priority>
                            <description>Zabbix在过去30分钟内未收到任何数据</description>
                            <manual_close>YES</manual_close>
                            <dependencies>
                                <dependency>
                                    <name>站点 {#SITE_NAME} 已禁用</name>
                                    <expression>last(/Template WAF Traffic Monitor Sender/waf.site.status[{#SITE_NAME}])=0</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>scope</tag>
                                    <value>availability</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>d30bed9b6d14455eb6d7d3916098cff7</uuid>
                            <name>站点 {#SITE_NAME} - 流量趋势</name>
                            <graph_items>
                                <graph_item>
                                    <color>1A7C11</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.bytes_in_rate_avg[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>F63100</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.bytes_out_rate_avg[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>2</sortorder>
                                    <drawtype>DASHED_LINE</drawtype>
                                    <color>00611C</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.bytes_in_rate_max[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>3</sortorder>
                                    <drawtype>DASHED_LINE</drawtype>
                                    <color>F7941D</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.bytes_out_rate_max[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                        <graph_prototype>
                            <uuid>d5b3c77a4b2b44d2bb02e0be586c3af9</uuid>
                            <name>站点 {#SITE_NAME} - 连接数趋势</name>
                            <graph_items>
                                <graph_item>
                                    <color>1A7C11</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.conn_cur_avg[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <drawtype>DASHED_LINE</drawtype>
                                    <color>2774A4</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.conn_cur_max[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>2</sortorder>
                                    <drawtype>GRADIENT_LINE</drawtype>
                                    <color>F63100</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.conn_rate_avg[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                        <graph_prototype>
                            <uuid>db53410a0b244fe39dd6040ad785bda3</uuid>
                            <name>站点 {#SITE_NAME} - HTTP请求趋势</name>
                            <graph_items>
                                <graph_item>
                                    <drawtype>GRADIENT_LINE</drawtype>
                                    <color>1A7C11</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.http_req_rate_avg[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>F63100</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.http_req_cnt_avg[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>2</sortorder>
                                    <drawtype>DASHED_LINE</drawtype>
                                    <color>2774A4</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.http_req_cnt_max[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                </discovery_rule>
            </discovery_rules>
            <tags>
                <tag>
                    <tag>class</tag>
                    <value>software</value>
                </tag>
                <tag>
                    <tag>target</tag>
                    <value>waf</value>
                </tag>
            </tags>
            <macros>
                <macro>
                    <macro>{$WAF.TRAFFIC.MAX.WARN}</macro>
                    <value>1048576</value>
                    <description>流量告警阈值(Bps)，默认1MB/s</description>
                </macro>
                <macro>
                    <macro>{$WAF.CONN.MAX.WARN}</macro>
                    <value>1000</value>
                    <description>连接数告警阈值</description>
                </macro>
                <macro>
                    <macro>{$WAF.REQ_RATE.MAX.WARN}</macro>
                    <value>100</value>
                    <description>HTTP请求速率告警阈值(rps)</description>
                </macro>
            </macros>
            <valuemaps>
                <valuemap>
                    <uuid>2bff266c841049928f85d14009ca94b7</uuid>
                    <name>站点状态</name>
                    <mappings>
                        <mapping>
                            <value>0</value>
                            <newvalue>禁用</newvalue>
                        </mapping>
                        <mapping>
                            <value>1</value>
                            <newvalue>启用</newvalue>
                        </mapping>
                    </mappings>
                </valuemap>
            </valuemaps>
        </template>
    </templates>
</zabbix_export>