<?xml version='1.0' encoding='UTF-8'?>
<zabbix_export>
    <version>6.0</version>
    <date>2024-01-22T15:07:42Z</date>
    <templates>
        <template>
            <uuid>48caa3c7c084438894b1831156b34ce7</uuid>
            <template>Template WAF Traffic Monitor Sender</template>
            <name>Template WAF Traffic Monitor Sender</name>
            <description>明御WAF流量监控模板 - Zabbix Sender模式，支持批量数据采集</description>
            <groups>
                <group>
                    <name>Templates/Applications</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>6e98f61efcb844cb8705638e735da75a</uuid>
                    <name>WAF数据采集器状态</name>
                    <type>TRAP</type>
                    <key>waf.collector.status</key>
                    <delay>0</delay>
                    <history>7d</history>
                    <trends>30d</trends>
                    <value_type>UNSIGNED</value_type>
                    <description>WAF数据采集器运行状态：1=正常，0=异常</description>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>collector</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>32fbff6780914b32b0e3856dac86edbd</uuid>
                    <name>WAF数据采集时间</name>
                    <type>TRAP</type>
                    <key>waf.collector.timestamp</key>
                    <delay>0</delay>
                    <history>7d</history>
                    <trends>0</trends>
                    <value_type>UNSIGNED</value_type>
                    <units>unixtime</units>
                    <description>最后一次成功采集数据的时间戳</description>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>collector</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>42d0b118f222441f8e270804660e56f4</uuid>
                    <name>WAF数据采集触发器</name>
                    <type>EXTERNAL</type>
                    <key>waf_sender.py["--waf-host","{$WAF.HOST}","--token","{$WAF.TOKEN}","--zabbix-server","{$ZABBIX.SERVER}","--zabbix-host","{HOST.HOST}","--quiet"]</key>
                    <delay>1m</delay>
                    <history>1d</history>
                    <trends>7d</trends>
                    <value_type>UNSIGNED</value_type>
                    <description>触发WAF数据采集，返回0表示成功，非0表示失败</description>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>trigger</value>
                        </tag>
                    </tags>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <uuid>de9fdfcf6f84413fa726a404273433d6</uuid>
                    <name>WAF站点发现</name>
                    <type>TRAP</type>
                    <key>waf.sites.discovery</key>
                    <delay>0</delay>
                    <lifetime>7d</lifetime>
                    <description>自动发现WAF中的所有站点</description>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>b49bf0bc078a42d39f4ab15a46b8a5f9</uuid>
                            <name>站点 {#SITE_NAME} - 状态</name>
                            <type>TRAP</type>
                            <key>waf.site.status[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>UNSIGNED</value_type>
                            <description>站点启用状态：1=启用，0=禁用</description>
                            <valuemap>
                                <name>站点状态</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>10m</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>site</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>b889512ab503488fbc910039575bc023</uuid>
                            <name>站点 {#SITE_NAME} - 入站流量速率(平均)</name>
                            <type>TRAP</type>
                            <key>waf.site.bytes_in_rate_avg[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <units>bps</units>
                            <description>入站流量速率平均值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>traffic</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                                <tag>
                                    <tag>direction</tag>
                                    <value>inbound</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>212ebd5399ec4e0daf44ad5940515227</uuid>
                            <name>站点 {#SITE_NAME} - 入站流量速率(最大)</name>
                            <type>TRAP</type>
                            <key>waf.site.bytes_in_rate_max[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <units>bps</units>
                            <description>入站流量速率最大值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>traffic</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                                <tag>
                                    <tag>direction</tag>
                                    <value>inbound</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>0f61b6ab1f49404c9b4efec0ed0f4497</uuid>
                            <name>站点 {#SITE_NAME} - 出站流量速率(平均)</name>
                            <type>TRAP</type>
                            <key>waf.site.bytes_out_rate_avg[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <units>bps</units>
                            <description>出站流量速率平均值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>traffic</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                                <tag>
                                    <tag>direction</tag>
                                    <value>outbound</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>f7ee1cbbc3854497ad5ff7bd8e6ce420</uuid>
                            <name>站点 {#SITE_NAME} - 出站流量速率(最大)</name>
                            <type>TRAP</type>
                            <key>waf.site.bytes_out_rate_max[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <units>bps</units>
                            <description>出站流量速率最大值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>traffic</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                                <tag>
                                    <tag>direction</tag>
                                    <value>outbound</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>e8c97fca51cd491ab6bf88d0cc1eb273</uuid>
                            <name>站点 {#SITE_NAME} - 当前连接数(平均)</name>
                            <type>TRAP</type>
                            <key>waf.site.conn_cur_avg[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <description>当前连接数平均值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>connection</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>47e82dc181c341e79f9dc545b7697c17</uuid>
                            <name>站点 {#SITE_NAME} - 当前连接数(最大)</name>
                            <type>TRAP</type>
                            <key>waf.site.conn_cur_max[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <description>当前连接数最大值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>connection</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>d973dc18228042689c2e49deb6475c2b</uuid>
                            <name>站点 {#SITE_NAME} - 连接速率(平均)</name>
                            <type>TRAP</type>
                            <key>waf.site.conn_rate_avg[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <units>cps</units>
                            <description>连接速率平均值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>connection</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>57816ac8c8a0403eab34b7692216cccd</uuid>
                            <name>站点 {#SITE_NAME} - HTTP请求数(平均)</name>
                            <type>TRAP</type>
                            <key>waf.site.http_req_cnt_avg[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <description>HTTP请求数平均值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>http</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>8704a004e5a44c7c973cbc2a7ae70a1a</uuid>
                            <name>站点 {#SITE_NAME} - HTTP请求数(最大)</name>
                            <type>TRAP</type>
                            <key>waf.site.http_req_cnt_max[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <description>HTTP请求数最大值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>http</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>9405417ef73c48e396754cf6db57f4eb</uuid>
                            <name>站点 {#SITE_NAME} - HTTP请求速率(平均)</name>
                            <type>TRAP</type>
                            <key>waf.site.http_req_rate_avg[{#SITE_NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>30d</trends>
                            <value_type>FLOAT</value_type>
                            <units>rps</units>
                            <description>HTTP请求速率平均值</description>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>http</value>
                                </tag>
                                <tag>
                                    <tag>site</tag>
                                    <value>{#SITE_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <uuid>a9cf31c3a7d84306bd05dcef002e01e1</uuid>
                            <expression>last(/Template WAF Traffic Monitor Sender/waf.site.status[{#SITE_NAME}])=0</expression>
                            <name>站点 {#SITE_NAME} 已禁用</name>
                            <priority>WARNING</priority>
                            <description>站点已被禁用</description>
                            <manual_close>YES</manual_close>
                            <tags>
                                <tag>
                                    <tag>scope</tag>
                                    <value>availability</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>5943c99c295c443ca91fe182a96fdf06</uuid>
                            <expression>avg(/Template WAF Traffic Monitor Sender/waf.site.bytes_in_rate_avg[{#SITE_NAME}],5m)&gt;{$WAF.TRAFFIC.MAX.WARN}</expression>
                            <name>站点 {#SITE_NAME} 入站流量过高</name>
                            <event_name>站点 {#SITE_NAME}: 入站流量过高 (超过 {$WAF.TRAFFIC.MAX.WARN} 5分钟)</event_name>
                            <priority>WARNING</priority>
                            <description>入站流量超过阈值</description>
                            <manual_close>YES</manual_close>
                            <tags>
                                <tag>
                                    <tag>scope</tag>
                                    <value>performance</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>e840c729c274403c8ef25d373698c333</uuid>
                            <expression>avg(/Template WAF Traffic Monitor Sender/waf.site.conn_cur_avg[{#SITE_NAME}],5m)&gt;{$WAF.CONN.MAX.WARN}</expression>
                            <name>站点 {#SITE_NAME} 连接数过高</name>
                            <event_name>站点 {#SITE_NAME}: 连接数过高 (超过 {$WAF.CONN.MAX.WARN} 5分钟)</event_name>
                            <priority>WARNING</priority>
                            <description>当前连接数超过阈值</description>
                            <manual_close>YES</manual_close>
                            <tags>
                                <tag>
                                    <tag>scope</tag>
                                    <value>performance</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>f6c8ed3935cb42b3acdb6854732e7506</uuid>
                            <expression>avg(/Template WAF Traffic Monitor Sender/waf.site.http_req_rate_avg[{#SITE_NAME}],5m)&gt;{$WAF.REQ_RATE.MAX.WARN}</expression>
                            <name>站点 {#SITE_NAME} HTTP请求速率过高</name>
                            <event_name>站点 {#SITE_NAME}: HTTP请求速率过高 (超过 {$WAF.REQ_RATE.MAX.WARN} 5分钟)</event_name>
                            <priority>WARNING</priority>
                            <description>HTTP请求速率超过阈值</description>
                            <manual_close>YES</manual_close>
                            <tags>
                                <tag>
                                    <tag>scope</tag>
                                    <value>performance</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>c5a12ed6a6bc43f4854df5517f5b200b</uuid>
                            <expression>nodata(/Template WAF Traffic Monitor Sender/waf.site.bytes_in_rate_avg[{#SITE_NAME}],30m)=1</expression>
                            <name>站点 {#SITE_NAME} 无法获取流量数据</name>
                            <event_name>站点 {#SITE_NAME}: 30分钟内无法获取流量数据</event_name>
                            <priority>WARNING</priority>
                            <description>Zabbix在过去30分钟内未收到任何数据</description>
                            <manual_close>YES</manual_close>
                            <dependencies>
                                <dependency>
                                    <name>站点 {#SITE_NAME} 已禁用</name>
                                    <expression>last(/Template WAF Traffic Monitor Sender/waf.site.status[{#SITE_NAME}])=0</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>scope</tag>
                                    <value>availability</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>9f62fc0f4f0c4d0dbdff2a4e3f64db56</uuid>
                            <name>站点 {#SITE_NAME} - 流量趋势</name>
                            <graph_items>
                                <graph_item>
                                    <color>1A7C11</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.bytes_in_rate_avg[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>F63100</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.bytes_out_rate_avg[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>2</sortorder>
                                    <drawtype>DASHED_LINE</drawtype>
                                    <color>00611C</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.bytes_in_rate_max[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>3</sortorder>
                                    <drawtype>DASHED_LINE</drawtype>
                                    <color>F7941D</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.bytes_out_rate_max[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                        <graph_prototype>
                            <uuid>58dcfb9398c34856aee5b23d667cd880</uuid>
                            <name>站点 {#SITE_NAME} - 连接数趋势</name>
                            <graph_items>
                                <graph_item>
                                    <color>1A7C11</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.conn_cur_avg[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <drawtype>DASHED_LINE</drawtype>
                                    <color>2774A4</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.conn_cur_max[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>2</sortorder>
                                    <drawtype>GRADIENT_LINE</drawtype>
                                    <color>F63100</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.conn_rate_avg[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                        <graph_prototype>
                            <uuid>dd54a65aba74407f9085172e9bb284b1</uuid>
                            <name>站点 {#SITE_NAME} - HTTP请求趋势</name>
                            <graph_items>
                                <graph_item>
                                    <drawtype>GRADIENT_LINE</drawtype>
                                    <color>1A7C11</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.http_req_rate_avg[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>F63100</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.http_req_cnt_avg[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>2</sortorder>
                                    <drawtype>DASHED_LINE</drawtype>
                                    <color>2774A4</color>
                                    <item>
                                        <host>Template WAF Traffic Monitor Sender</host>
                                        <key>waf.site.http_req_cnt_max[{#SITE_NAME}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                </discovery_rule>
            </discovery_rules>
            <tags>
                <tag>
                    <tag>class</tag>
                    <value>software</value>
                </tag>
                <tag>
                    <tag>target</tag>
                    <value>waf</value>
                </tag>
            </tags>
            <macros>
                <macro>
                    <macro>{$WAF.HOST}</macro>
                    <value>https://10.21.30.5:8443</value>
                    <description>WAF管理地址</description>
                </macro>
                <macro>
                    <macro>{$WAF.TOKEN}</macro>
                    <value>YOUR_TOKEN_HERE</value>
                    <description>WAF API Token</description>
                </macro>
                <macro>
                    <macro>{$ZABBIX.SERVER}</macro>
                    <value>127.0.0.1</value>
                    <description>Zabbix服务器地址</description>
                </macro>
                <macro>
                    <macro>{$WAF.TRAFFIC.MAX.WARN}</macro>
                    <value>1048576</value>
                    <description>流量告警阈值(Bps)，默认1MB/s</description>
                </macro>
                <macro>
                    <macro>{$WAF.CONN.MAX.WARN}</macro>
                    <value>1000</value>
                    <description>连接数告警阈值</description>
                </macro>
                <macro>
                    <macro>{$WAF.REQ_RATE.MAX.WARN}</macro>
                    <value>100</value>
                    <description>HTTP请求速率告警阈值(rps)</description>
                </macro>
            </macros>
            <valuemaps>
                <valuemap>
                    <uuid>71d78377120c4b3ba6424c7f1ce61033</uuid>
                    <name>站点状态</name>
                    <mappings>
                        <mapping>
                            <value>0</value>
                            <newvalue>禁用</newvalue>
                        </mapping>
                        <mapping>
                            <value>1</value>
                            <newvalue>启用</newvalue>
                        </mapping>
                    </mappings>
                </valuemap>
            </valuemaps>
        </template>
    </templates>
</zabbix_export>